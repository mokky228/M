<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡πÄ‡∏Å‡∏°‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢ AI</title>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/pose@latest"></script>

<style>
body {
    text-align: center;
    font-family: Arial, sans-serif;
    background: #eef6ff;
}
canvas {
    width: 320px;
    height: 240px;
    border-radius: 10px;
}
.score {
    font-size: 32px;
    color: #2e8b57;
}
.pose {
    font-size: 24px;
}
</style>
</head>

<body>

<h1>üéÆ ‡πÄ‡∏Å‡∏°‡∏Ç‡∏¢‡∏±‡∏ö‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢</h1>
<p>‡∏¢‡∏∑‡∏î‡∏ã‡πâ‡∏≤‡∏¢ / ‡∏¢‡∏∑‡∏î‡∏Ç‡∏ß‡∏≤ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>

<div class="score">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="score">0</span></div>
<div class="pose">‡∏ó‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: <span id="pose">-</span></div>

<canvas id="canvas" width="320" height="240"></canvas>

<script>
const URL = "https://teachablemachine.withgoogle.com/models/nu7p8H_8b/";

let model, webcam, ctx;
let score = 0;
let lastPose = "";

async function init() {
    const modelURL = URL + "model.json";
    const metadataURL = URL + "metadata.json";

    model = await tmPose.load(modelURL, metadataURL);

    webcam = new tmPose.Webcam(320, 240, true);
    await webcam.setup();
    await webcam.play();
    window.requestAnimationFrame(loop);

    const canvas = document.getElementById("canvas");
    ctx = canvas.getContext("2d");
}

async function loop() {
    webcam.update();
    await predict();
    window.requestAnimationFrame(loop);
}

async function predict() {
    const { pose, posenetOutput } = await model.estimatePose(webcam.canvas);
    const prediction = await model.predict(posenetOutput);

    let bestClass = "";
    let bestProb = 0;

    for (let i = 0; i < prediction.length; i++) {
        if (prediction[i].probability > bestProb) {
            bestProb = prediction[i].probability;
            bestClass = prediction[i].className;
        }
    }

    document.getElementById("pose").innerText = bestClass;

    // ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ‡∏ã‡πâ‡∏≤‡∏¢ / ‡∏Ç‡∏ß‡∏≤
    if (bestProb > 0.9 && bestClass !== lastPose) {
        if (bestClass === "‡∏ã‡πâ‡∏≤‡∏¢" || bestClass === "‡∏Ç‡∏ß‡∏≤") {
            score += 10;
            document.getElementById("score").innerText = score;
        }
        lastPose = bestClass;
    }

    drawPose(pose);
}

function drawPose(pose) {
    ctx.drawImage(webcam.canvas, 0, 0);
    if (pose) {
        const minPartConfidence = 0.5;
        tmPose.drawKeypoints(pose.keypoints, minPartConfidence, ctx);
        tmPose.drawSkeleton(pose.keypoints, minPartConfidence, ctx);
    }
}

init();
</script>

</body>
</html>
